<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙƒÙŠ</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #ec4899;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --dark: #1e293b;
  --light: #f8fafc;
  --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

body {
  font-family: 'Cairo', sans-serif;
  background: var(--gradient);
  min-height: 100vh;
  padding: 20px;
  direction: rtl;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

.header {
  text-align: center;
  color: white;
  margin-bottom: 30px;
  animation: fadeInDown 0.8s ease;
}

.header h1 {
  font-size: 2.5rem;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.header p {
  opacity: 0.9;
  font-size: 1.1rem;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  margin-bottom: 20px;
  animation: fadeInUp 0.8s ease;
}

.stats-bar {
  display: flex;
  justify-content: center;
  padding: 20px;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  border-radius: 15px;
  margin-bottom: 25px;
  border: 2px solid #bae6fd;
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 3rem;
  font-weight: 700;
  color: var(--primary);
  line-height: 1;
}

.stat-label {
  color: #64748b;
  font-size: 16px;
  font-weight: 600;
  margin-top: 5px;
}

.search-section {
  position: relative;
  margin-bottom: 25px;
}

.search-box {
  position: relative;
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.search-input {
  flex: 1;
  padding: 15px 20px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-size: 16px;
  font-family: 'Cairo', sans-serif;
  transition: all 0.3s ease;
  background: #f8fafc;
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
  background: white;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.search-btn {
  padding: 15px 30px;
  background: var(--gradient);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
}

.suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.15);
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
  display: none;
  margin-top: 5px;
  border: 1px solid #e2e8f0;
}

.suggestions.active {
  display: block;
  animation: slideDown 0.3s ease;
}

.suggestion-item {
  padding: 15px 20px;
  cursor: pointer;
  border-bottom: 1px solid #f1f5f9;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 12px;
}

.suggestion-item:hover {
  background: #f8fafc;
  padding-right: 25px;
}

.suggestion-item:last-child {
  border-bottom: none;
}

.suggestion-item .avatar {
  width: 40px;
  height: 40px;
  background: var(--gradient);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 14px;
}

.suggestion-item .info {
  flex: 1;
}

.suggestion-item .name {
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 2px;
}

.suggestion-item .details {
  font-size: 12px;
  color: #64748b;
  display: flex;
  gap: 10px;
}

.suggestion-item .major-tag {
  background: var(--primary);
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 25px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group label {
  font-weight: 600;
  color: var(--dark);
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.form-group input,
.form-group select {
  padding: 12px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  font-size: 15px;
  font-family: 'Cairo', sans-serif;
  transition: all 0.3s ease;
  background: #f8fafc;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--primary);
  background: white;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-group input:read-only {
  background: #e2e8f0;
  cursor: not-allowed;
}

.points-section {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 25px;
  border: 2px solid #bae6fd;
}

.points-display {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 15px;
}

.points-number {
  font-size: 3rem;
  font-weight: 700;
  color: var(--primary);
}

.points-label {
  color: #64748b;
  font-weight: 600;
}

.points-input-group {
  display: flex;
  gap: 10px;
}

.points-input {
  flex: 1;
  padding: 12px;
  border: 2px solid #e2e8f0;
  border-radius: 10px;
  text-align: center;
  font-size: 16px;
  font-weight: 600;
}

.btn-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex: 1;
  min-width: 120px;
}

.btn-primary {
  background: var(--gradient);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #059669;
  transform: translateY(-2px);
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover {
  background: #dc2626;
  transform: translateY(-2px);
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-warning:hover {
  background: #d97706;
  transform: translateY(-2px);
}

.btn-secondary {
  background: #6b7280;
  color: white;
}

.btn-secondary:hover {
  background: #4b5563;
  transform: translateY(-2px);
}

.message {
  padding: 15px 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  display: none;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  animation: slideIn 0.3s ease;
}

.message.show {
  display: flex;
}

.message.success {
  background: #d1fae5;
  color: #065f46;
  border: 1px solid #a7f3d0;
}

.message.error {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fecaca;
}

.message.info {
  background: #dbeafe;
  color: #1e40af;
  border: 1px solid #bfdbfe;
}

.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s linear infinite;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@media (max-width: 600px) {
  .header h1 {
    font-size: 1.8rem;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .search-box {
    flex-direction: column;
  }
  
  .btn-group {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
  
  .stat-value {
    font-size: 2.5rem;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
    <p>Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù†Ù‚Ø§Ø·</p>
  </div>

  <div class="card">
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="totalStudents">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
      </div>
    </div>

    <div id="message" class="message"></div>

    <div class="search-section">
      <div class="search-box">
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… (Ø£ÙˆÙ„ Ø­Ø±ÙÙŠÙ† ÙƒØ§ÙÙŠØ©)..." 
          autocomplete="off"
          oninput="handleSearchInput(this.value)"
        />
        <button class="search-btn" onclick="searchStudent()">
          <span>Ø¨Ø­Ø«</span>
        </button>
      </div>
      <div id="suggestions" class="suggestions"></div>
    </div>

    <div class="form-grid">
      <div class="form-group">
        <label>ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</label>
        <input type="text" id="studentId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ" />
      </div>
      
      <div class="form-group">
        <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" />
      </div>
      
      <div class="form-group">
        <label>ğŸ“Š Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
        <input type="text" id="studentGrade" placeholder="Ù…Ø«Ø§Ù„: 95%" oninput="formatGrade(this)" />
      </div>
      
      <div class="form-group">
        <label>ğŸ¯ Ø§Ù„ØªØ®ØµØµ</label>
        <select id="studentMajor">
          <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª...</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>ğŸ“± Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
        <input type="text" id="studentWhatsapp" placeholder="Ù…Ø«Ø§Ù„: 0551234567" />
      </div>
      
      <div class="form-group">
        <label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="text" id="studentPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
      </div>
    </div>

    <div class="points-section">
      <div class="points-display">
        <div>
          <div class="points-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
          <div class="points-number" id="currentPoints">0</div>
        </div>
        <div style="font-size: 3rem;">â­</div>
      </div>
      <div class="points-input-group">
        <input 
          type="number" 
          id="pointsChange" 
          class="points-input" 
          placeholder="+/- Ø§Ù„Ù†Ù‚Ø§Ø·"
        />
        <button class="btn btn-warning" onclick="updatePoints()">
          âš¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
        </button>
      </div>
    </div>

    <div class="btn-group">
      <button class="btn btn-success" onclick="addStudent()">
        â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
      </button>
      <button class="btn btn-primary" onclick="saveStudent()">
        ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
      </button>
      <button class="btn btn-danger" onclick="deleteStudent()">
        ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨
      </button>
      <button class="btn btn-secondary" onclick="clearForm()">
        ğŸ”„ Ø¬Ø¯ÙŠØ¯
      </button>
    </div>
  </div>
</div>

<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyAEXAMPLEnY", 
  authDomain: "store-points-7d2f4.firebaseapp.com",
  databaseURL: "https://store-points-7d2f4-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "store-points-7d2f4",
  storageBucket: "store-points-7d2f4.appspot.com",
  messagingSenderId: "105011111111",
  appId: "1:105011111111:web:abc123example"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let allStudents = [];
let currentStudent = null;
let availableMajors = [];

// Load all students and majors on startup
window.onload = function() {
  loadAllStudents();
  loadMajors();
};

function loadAllStudents() {
  db.ref('users').on('value', (snapshot) => {
    const data = snapshot.val() || {};
    allStudents = Object.entries(data).map(([id, student]) => ({
      id,
      ...student
    }));
    updateStats();
  });
}

function loadMajors() {
  db.ref('users').once('value', (snapshot) => {
    const data = snapshot.val() || {};
    const majorsSet = new Set();
    
    Object.values(data).forEach(student => {
      if (student.major && student.major.trim() !== '') {
        majorsSet.add(student.major.trim());
      }
    });
    
    availableMajors = Array.from(majorsSet).sort();
    populateMajorsSelect();
  });
}

function populateMajorsSelect() {
  const select = document.getElementById('studentMajor');
  select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>';
  
  availableMajors.forEach(major => {
    const option = document.createElement('option');
    option.value = major;
    option.textContent = major;
    select.appendChild(option);
  });
  
  // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± "ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯" Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
  const newOption = document.createElement('option');
  newOption.value = "__new__";
  newOption.textContent = "+ Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯";
  select.appendChild(newOption);
  
  // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ± Ù„Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯
  select.onchange = function() {
    if (this.value === "__new__") {
      const newMajor = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
      if (newMajor && newMajor.trim() !== "") {
        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if (!availableMajors.includes(newMajor.trim())) {
          availableMajors.push(newMajor.trim());
          availableMajors.sort();
          populateMajorsSelect();
        }
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        setTimeout(() => {
          document.getElementById('studentMajor').value = newMajor.trim();
        }, 100);
      } else {
        this.value = "";
      }
    }
  };
}

function updateStats() {
  document.getElementById('totalStudents').textContent = allStudents.length;
}

function showMessage(text, type = 'info') {
  const msgEl = document.getElementById('message');
  msgEl.innerHTML = text;
  msgEl.className = `message ${type} show`;
  setTimeout(() => {
    msgEl.classList.remove('show');
  }, 4000);
}

function handleSearchInput(value) {
  const suggestionsEl = document.getElementById('suggestions');
  
  if (value.length < 2) {
    suggestionsEl.classList.remove('active');
    return;
  }
  
  const searchTerm = value.toLowerCase();
  const matches = allStudents.filter(student => 
    student.name && student.name.toLowerCase().includes(searchTerm)
  ).slice(0, 10);
  
  if (matches.length === 0) {
    suggestionsEl.innerHTML = '<div class="suggestion-item"><div class="info"><div class="name">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div></div>';
    suggestionsEl.classList.add('active');
    return;
  }
  
  suggestionsEl.innerHTML = matches.map(student => `
    <div class="suggestion-item" onclick="selectStudent('${student.id}')">
      <div class="avatar">${student.name.charAt(0)}</div>
      <div class="info">
        <div class="name">${highlightMatch(student.name, value)}</div>
        <div class="details">
          <span>Ø§Ù„Ø±Ù‚Ù…: ${student.id}</span>
          <span>Ø§Ù„Ù†Ù‚Ø§Ø·: ${student.points || 0}</span>
          ${student.major ? `<span class="major-tag">${student.major}</span>` : ''}
        </div>
      </div>
    </div>
  `).join('');
  
  suggestionsEl.classList.add('active');
}

function highlightMatch(text, query) {
  const regex = new RegExp(`(${query})`, 'gi');
  return text.replace(regex, '<span style="color: var(--primary); font-weight: bold;">$1</span>');
}

function selectStudent(id) {
  document.getElementById('suggestions').classList.remove('active');
  document.getElementById('searchInput').value = '';
  
  const student = allStudents.find(s => s.id === id);
  if (student) {
    fillForm(student);
    showMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª: ${student.name} | Ø§Ù„ØªØ®ØµØµ: ${student.major || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`, 'success');
  }
}

function fillForm(student) {
  currentStudent = student;
  document.getElementById('studentId').value = student.id;
  document.getElementById('studentName').value = student.name || '';
  document.getElementById('studentGrade').value = student.grade || '';
  
  // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ù†Ø¶ÙŠÙÙ‡
  if (student.major && !availableMajors.includes(student.major)) {
    availableMajors.push(student.major);
    availableMajors.sort();
    populateMajorsSelect();
  }
  
  document.getElementById('studentMajor').value = student.major || '';
  document.getElementById('studentWhatsapp').value = student.whatsappLink || '';
  document.getElementById('studentPassword').value = student.password || '';
  document.getElementById('currentPoints').textContent = student.points || 0;
  
  // Ø¬Ø¹Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  document.getElementById('studentId').readOnly = true;
}

function searchStudent() {
  const searchValue = document.getElementById('searchInput').value.trim();
  if (!searchValue) {
    showMessage('âš ï¸ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¨Ø­Ø«', 'error');
    return;
  }
  
  // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø£Ùˆ Ø§Ø³Ù…
  const byId = allStudents.find(s => s.id === searchValue);
  if (byId) {
    selectStudent(byId.id);
    return;
  }
  
  // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…
  const byName = allStudents.find(s => 
    s.name && s.name.toLowerCase().includes(searchValue.toLowerCase())
  );
  
  if (byName) {
    selectStudent(byName.id);
  } else {
    showMessage('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨', 'error');
  }
}

function formatGrade(input) {
  let value = input.value.replace('%', '').trim();
  if (value) {
    input.value = value + '%';
  }
}

function addStudent() {
  const id = document.getElementById('studentId').value.trim();
  const name = document.getElementById('studentName').value.trim();
  
  if (!id || !name) {
    showMessage('âš ï¸ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
    return;
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
  if (allStudents.some(s => s.id === id)) {
    showMessage('âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
    return;
  }
  
  const studentData = {
    name: name,
    grade: document.getElementById('studentGrade').value,
    major: document.getElementById('studentMajor').value,
    whatsappLink: document.getElementById('studentWhatsapp').value,
    password: document.getElementById('studentPassword').value,
    points: 0,
    createdAt: new Date().toISOString()
  };
  
  db.ref('users/' + id).set(studentData)
    .then(() => {
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      if (studentData.major && !availableMajors.includes(studentData.major)) {
        availableMajors.push(studentData.major);
        availableMajors.sort();
        populateMajorsSelect();
      }
      showMessage('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      clearForm();
    })
    .catch(err => {
      showMessage('âŒ Ø®Ø·Ø£: ' + err.message, 'error');
    });
}

function saveStudent() {
  const id = document.getElementById('studentId').value.trim();
  if (!id) {
    showMessage('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„', 'error');
    return;
  }
  
  if (!currentStudent) {
    showMessage('âš ï¸ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', 'error');
    return;
  }
  
  const newMajor = document.getElementById('studentMajor').value;
  
  const updates = {
    name: document.getElementById('studentName').value,
    grade: document.getElementById('studentGrade').value,
    major: newMajor,
    whatsappLink: document.getElementById('studentWhatsapp').value,
    password: document.getElementById('studentPassword').value,
    updatedAt: new Date().toISOString()
  };
  
  db.ref('users/' + id).update(updates)
    .then(() => {
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      if (newMajor && !availableMajors.includes(newMajor)) {
        availableMajors.push(newMajor);
        availableMajors.sort();
        populateMajorsSelect();
      }
      showMessage('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
    })
    .catch(err => {
      showMessage('âŒ Ø®Ø·Ø£: ' + err.message, 'error');
    });
}

function updatePoints() {
  const id = document.getElementById('studentId').value.trim();
  const pointsInput = document.getElementById('pointsChange').value;
  
  if (!id) {
    showMessage('âš ï¸ Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹', 'error');
    return;
  }
  
  if (!pointsInput || isNaN(pointsInput)) {
    showMessage('âš ï¸ Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·', 'error');
    return;
  }
  
  const pointsToAdd = parseInt(pointsInput);
  const currentPoints = parseInt(document.getElementById('currentPoints').textContent) || 0;
  const newPoints = currentPoints + pointsToAdd;
  
  if (newPoints < 0) {
    showMessage('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ø³Ø§Ù„Ø¨Ø©', 'error');
    return;
  }
  
  db.ref('users/' + id).update({ points: newPoints })
    .then(() => {
      document.getElementById('currentPoints').textContent = newPoints;
      document.getElementById('pointsChange').value = '';
      const action = pointsToAdd > 0 ? 'Ø¥Ø¶Ø§ÙØ©' : 'Ø®ØµÙ…';
      showMessage(`âœ… ØªÙ… ${action} ${Math.abs(pointsToAdd)} Ù†Ù‚Ø·Ø©`, 'success');
    })
    .catch(err => {
      showMessage('âŒ Ø®Ø·Ø£: ' + err.message, 'error');
    });
}

function deleteStudent() {
  const id = document.getElementById('studentId').value.trim();
  if (!id) {
    showMessage('âš ï¸ Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨Ø§Ù‹ Ù„Ù„Ø­Ø°Ù', 'error');
    return;
  }
  
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
    return;
  }
  
  db.ref('users/' + id).remove()
    .then(() => {
      showMessage('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      clearForm();
    })
    .catch(err => {
      showMessage('âŒ Ø®Ø·Ø£: ' + err.message, 'error');
    });
}

function clearForm() {
  currentStudent = null;
  document.getElementById('studentId').value = '';
  document.getElementById('studentId').readOnly = false;
  document.getElementById('studentName').value = '';
  document.getElementById('studentGrade').value = '';
  document.getElementById('studentMajor').value = '';
  document.getElementById('studentWhatsapp').value = '';
  document.getElementById('studentPassword').value = '';
  document.getElementById('currentPoints').textContent = '0';
  document.getElementById('pointsChange').value = '';
  document.getElementById('searchInput').value = '';
  document.getElementById('suggestions').classList.remove('active');
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener('click', (e) => {
  if (!e.target.closest('.search-section')) {
    document.getElementById('suggestions').classList.remove('active');
  }
});
</script>

</body>
</html>
